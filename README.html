<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>README.html</title>
<meta http-equiv="Content-Type" content="application/xhtml+xml;charset=utf-8"/>
<link rel="stylesheet" type="text/css" media="all" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css"  />
<link rel="stylesheet" type="text/css" media="all" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/github.min.css"  /><meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'><style> body { box-sizing: border-box; max-width: 740px; width: 100%; margin: 40px auto; padding: 0 10px; } </style><script id='MathJax-script' async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'></script><script src='https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js'></script><script>document.addEventListener('DOMContentLoaded', () => { document.body.classList.add('markdown-body'); document.querySelectorAll('pre[lang] > code').forEach((code) => { code.classList.add(code.parentElement.lang); }); document.querySelectorAll('pre > code').forEach((code) => { hljs.highlightBlock(code); }); });</script>
</head>

<body>

<h1>NQueensFAF</h1>

<p>Insanely fast Solvers for the N queens problem, one for GPUs (definitely try
this one) and one for CPUs. Also provides useful utilities for implementing
custom N queens problem solving algorithms. Features are: <br>
1) supports GPU-computing and also CPU-Multithreading<br> 
2) distribution among multiple GPUs (soon done automatically in proportion to performance)<br>
3) auto progress save and continuing from save file<br>
4) some advanced settings, see explanation of the command line usage<br>
Can run on Windows, Linux and also Mac (for download and installation see
below).<br> 
The standard version uses a command line interface, which is easy to use
(examples below). However we also linked a GUI program of an older version. <br>
Built with Java 17.<br>
<strong>NOTE:</strong> currently only works for NVIDIA and integrated Intel GPUs.</p>

<h1>1 Distributed Computing</h1>

<p>We recently started a distributed computing project for solving the N Queens
problem! The goals are: 
1) Solve N=27 and confirm the results of the TU Dresden. (currently in progress)<br>
You can check the current progress on the 27 queens problem <a href="http://nqueensfaf.de:14772/progress">here</a>. 
2) Solve N=28 and set the new world record.</p>

<h2>1.1 How to contribute</h2>

<p>Although the client is working just fine, we are still developing it.<br> 
<strong>PLEASE CHECK FOR UPDATES</strong> from time to time, until updates will be fetched
automatically (coming soon).</p>

<h3>Windows</h3>

<p>Download and install the <a href="https://github.com/olepoeschl/NQueensFAF-GUI/releases/download/1.17/nqueens-client.exe">Windows Client</a>.
After that, just double click the desktop icon - the rest is self
explanatory. Alternatively you may follow the same installation process as for
Linux and Mac, see below.<br> </p>

<p><strong>NOTE:</strong> Your anti virus program may tell you that the program is not safe
(although it is). In this case you must manually ignore the warning or even the
program as an exception to the anti virus software.<br></p>

<h3>Linux and Mac (and also Windows)</h3>

<p>You first have to install the <a href="https://www.oracle.com/de/java/technologies/downloads/#java21">Java JDK</a> and also
OpenCL. In Windows and Mac the OpenCL Libraries should be included in the graphics
driver, in Linux you may have to install the missing libraries manually. After
that, download the jar and run it by executing the  command<br>
<code>java -jar nqueens-client.jar nqueensfaf.de</code>
in the directory where the jar is located. (nqueensfaf.de is the server that
sends the workloads and gets the results) <br></p>

<p><strong>NOTE:</strong> Eventually adapt the name 'nqueens-client.jar' to the actual name of the jar
you downloaded. </p>

<h1>2 Local Computing</h1>

<h2>2.1 Download and Installation</h2>

<p>The following sections always refer to the most recent version of NQueensFAF. In
case you want to try out older versions, just visit the
<a href="https://github.com/olepoeschl/NQueensFAF/releases">Releases</a> section. The
installation process remains the same as described below. <br></p>

<h3>The simplest Way</h3>

<p>1) Choose the 
<a href="https://github.com/olepoeschl/NQueensFAF/releases/latest">Latest Stable Release</a> 
or the 
<a href="https://github.com/olepoeschl/NQueensFAF/releases/tag/nightly">Latest Nightly Build</a> 
and download the zip file that fits your Operating System. 
2) Unpack the zip file and open a console in the unpacked directory. 
3) Run the application by typing <code>./nqueensfaf-cli 16</code> (Linux)
or <code>nqueensfaf-cli 16</code> (Windows).
4) Check out the section <a href="docs/usage">Usage</a> for an overview of all possible
commands including examples. <br>
<strong>NOTE:</strong> If you can not run the program try the command <code>chmod +x nqueensfaf-cli</code>
between steps 2 and 3. </p>

<h3>The Java Way</h3>

<p>0) First <a href="https://www.oracle.com/de/java/technologies/downloads/#java21">install Java</a> for your OS. 
1) Choose the 
<a href="https://github.com/olepoeschl/NQueensFAF/releases/latest">Latest Stable Release</a> 
or the 
<a href="https://github.com/olepoeschl/NQueensFAF/releases/tag/nightly">Latest Nightly Build</a> 
and download the <code>nqueensfaf-cli-***.jar</code> file (NOTE the -cli suffix). 
2) open a console in the directory where the jar is located. <br />
3) run the jar by typing <code>java -jar nqueensfaf-cli.jar 16 cpu</code> (same command for
all operating systems). 
4) Check out the section <a href="docs/Usage">Usage</a> for an overview of all possible
commands including examples.</p>

<h3>A GUI Version</h3>

<p>In case you are a Windows User and prefer a graphical user interface you
can downlad the following <a href="https://github.com/olepoeschl/NQueensFAF-GUI/releases/download/1.17/nqueensfaf.exe">Windows Installer with GUI</a>.<br></p>

<h1>3 News</h1>

<ul>
<li>The distributed computing for solving the 27 Queens problem has begun.<br>
Download the client and get started (see <strong>1 Distributed Computing</strong>)!  </li>
<li>We are excited to announce that we have successfully verified the number of solutions for the <strong>26-Queens problem</strong>. <br> 
The computation was performed using 3 GPUs (2x3070, 1x3060ti) and it took slightly more than 3 weeks to finish. <br>
27 - Here we come! <br></li>
</ul>

<h1>4 Current Benchmarks</h1>

<p>During the time we have spent developing this NQueensFAF, we have been able to
continuously expand our available hardware. Especially the newer graphics cards
show the potential of our program.</p>

<p><b>GPUs</b>
|      Board size N     |   18    |     19    |      20      |      21      |      22      |       23       |       24       |   25 |
|      :----------:     |   :-:   |    :-:    |      :-:     |      :-:     |      :-:     |       :-:      |      :-:       |  :-: |
|      RTX 3080 FE      |  0.03s  |   0.77s   |     5.85s    |     0:48m    |      6:56m   |      1:02h     |      9:45h     | 4d 7h |
|     RTX 3060 Ti FE    |  0.10s  |   1.26s   |    10.18s    |     1:23m    |     12:10m   |      1:49h     |     17:50h     | 7d 2h |
|      GTX 1650 Ti      |  0.40s  |   3.62s   |    29.08s    |     4:02m    |     35:21m   |  not measured  |  not measured  | not measured |
|     Intel UHD 770     |  4.71s  |  32.98s   |     4:18m    |    36:13m    | not measured |  not measured  |  not measured  | not measured | 
|       RX 6650 XT      |  0.28s  |   2.00s   |    16.60s    |     2:13m    |     19:14m   |  3:03h  |  not measured  | not measured |</p>

<p><b>CPUs</b>
|      Board size N     |        16       |     17    |     18    |     19    |      20      |      21      |      22      |
|      :----------:     |       :-:       |    :-:    |    :-:    |    :-:    |      :-:     |      :-:     |      :-:     |
|  i5 - 12600k single   |      1.12s      |   7.04s   |   49.92s  |   6:21m   |    57:47m    | not measured | not measured |
|  i5 - 12600k multi    |      0.203s     |   0.79s   |   4.91s   |   37.1s   |     4:59m    |    42:20m    |     6:09h    |
|   i5 - 9300h single   |      1.32s      |   8.95s   |   1:05m   |   8:20m   |     1:10h    | not measured | not measured |
|   i5 - 9300h multi    |      0.25s      |   1.75s   |   12.5s   |   1:35m   |    13:05m    |     1:52h    |     16:18h   |
|   Ryzen 5800X single  |      0.91s      |   6.09s   |   44.3s   |   5:38m   |    45:24m    | mot measured | not measured |
|   Ryzen 5800X multi   |      0.28s      |   0.70s   |   4.06s   |   30.3s   |     4:04m    |    33:53m    | not measured |</p>

<p>Single stands for single-threaded and multi for Multi-threaded. 
The CPUs and the GPUs are used with stock settings. </p>

<p>Attention: Your graphics card may go into another power state when running the program. To check this and to avoid this, you can use a tool such as "nvidiainfo".</p>

<h1>5 Usage</h1>

<p>Show the general help message by using <code>nqueensfaf-cli -h</code>and the device
specific help messages by using either <code>nqueensfaf-cli 20 gpu -h</code> or
<code>nqueensfaf-cli 20 cpu -h</code>.</p>

<h2>5.1 Compact Explanation</h2>

<p>The command format reads as follows:<br>
<code>nqueensfaf-cli [-u=\&lt;update-interval\&gt;] [-s=\&lt;auto-save-interval\&gt;] [\&lt;N\&gt; |
\&lt;path-to-save-file\&gt;] [cpu | gpu] [\&lt;extra device options\&gt;]
[-p=\&lt;pre-queens\&gt;] [-h]</code>
Explanation of the Options:
- <code>-s=\&lt;value\&gt;</code> ⟶ auto save interval as a decimal, for example -s=0.05 for
  auto-saving each 5%
- <code>-u=\&lt;value\&gt;</code> ⟶ update time, solution and progress after <value> milliseconds
- <code>N</code> ⟶ substitute the board size 
- <code>cpu</code> | <code>gpu</code> ⟶ write cpu for choosing cpu and gpu for choosing gpu (device
  specific options see below)
- <code>-p=\&lt;value\&gt;</code> ⟶ default is 6. A higher number means more but smaller tasks by setting
  additional queens before sending to the solver device. Most of the time 6 is
  the best option.
- <code>-h</code>  ⟶ print device specific help message
Device options the CPU: <code>nqueensfaf [...] 20 cpu [-t=\&lt;threadcount\&gt;]</code>
- <code>-t=\&lt;value\&gt;</code> ⟶ use <value> threads
Device options for GPUs: <code>nqueensfaf [...] 20 gpu [-g=\&lt;gpu1\&gt;:\&lt;option1\&gt;\&lt;value1\&gt;:\&lt;option2\&gt;\&lt;value2\&gt;:...] [-l] [-h]</code> 
- <code>-l</code>  ⟶ list all GPUs in a nice table (usefull for choosing name value)
- <code>-h</code>  ⟶ print GPU specific help message
- <code>-g=[...]</code>  ⟶ GPUs that should be used in the format of
  - <code>\&lt;string_contained_in_name\&gt;[:\&lt;attr\&gt;\&lt;val\&gt;[,:\&lt;attr\&gt;\&lt;val\&gt;]]</code>
  - \<attr\> can be one of the following: wg, bm, al
  - \<val\> is the value that should be assigned to the attribute, if the attribute expects one</p>

<h2>5.2 Extended Explanation with Examples</h2>

<p>Depending on your way of installation you start the command with<br>
- <code>nqueensfaf-cli</code> (Windows)
- <code>./nqueensfaf-cli</code> (Linux and Mac)
- <code>java -jar nqueensfaf-cli.jar</code> (Java). 
Here we always use <code>nqueensfaf-cli</code>.<br>
The board size (N) and the device (cpu or gpu) must always be specified.<br></p>

<h3>Explanation for CPU</h3>

<ul>
<li><code>nqueensfaf-cli 16 cpu</code>  (N=16 on CPU with 1 thread)</li>
<li><code>nqueensfaf-cli 18 cpu -t=8</code> (N=18 on CPU with 8 threads)</li>
<li><code>nqueensfaf-cli 20 -s=0.05 cpu -t=8</code> (N=20 with 8 threads and auto-saves in 5%
steps)</li>
<li><p><code>nqueensfaf-cli -s=0.05 cpu ./20-queens.faf cpu -t=8</code> (continue the solution of
the 20 queens problem from the save-file 20-queens.faf)</p>

<h3>Explanation for GPUs</h3></li>
<li><p><code>nqueensfaf-cli 20 gpu --list-gpus</code> (list all GPUs by name) </p></li>
<li><code>nqueensfaf-cli 20 gpu -g=&lt;name&gt;:bm1</code> (compute N=20 on the GPU <name>. The :bm1
flag represents benchmark and is required, but only takes effect if multiple
GPUs are used, each one with its own benchmark score. A lower score shifts more
work towards a GPU. )
Also, <name> may include only a part of the full name. For referring to 'RTX
3080 Founders Edition' it suffices to use the name '3080'.<br> 
The GPU option flags are generally separated by ':'. Flags are </li>
<li>wg (workgroup size on the GPU, standard option 64 is best for NVIDIA GPUs.
Only set it to 24 for integrated Intel GPUs)</li>
<li>al (for systems with more than 1 GPU. use all GPUs containing the string
<name> in their description)
Some Examples:</li>
<li><code>nqueensfaf-cli 20 gpu -g=3080:bm1</code> (N=20 on GPU 'RTX 3080 Founders Edition'
with the default workgroup size 64)</li>
<li><code>nqueensfaf-cli 19 gpu -g=intel:bm1:wg24</code> (N=19 on Intel GPU with workgroup size
24)
In case you have multiple 3080 GPUs and all should contribute equally use</li>
<li><code>nqueensfaf-cli 23 gpu -g=3080:al:bm1</code> 
In case you have one 3080 and 1 3060ti and want the 3080 to get twice as much
work as the 3070 with autosaves each 5% use </li>
<li><code>nqueensfaf-cli -s=0.05 23 gpu -g=3080:bm1,3070:bm2</code>
Last but not least, resume the computation from the save-file 23-queens.faf with
only the 3070:</li>
<li><code>nqueensfaf-cli -s=0.05 23 gpu -g=3070:bm1</code> 
NOTE: you must enable auto-saving again each time you resume from a save-file) </li>
</ul>

<h2>5.3 Java usage</h2>

<p>CPUSolver s = new CPUSolver()
      .config(config -> {
            config.threadcount = 1;
            config.updateInterval = 200;
      })
      .onInit(self -> System.out.println("Starting Solver for board size " + self.getN() + "..."))
      .onUpdate((self, progress, solutions, duration) -> System.out.println("progress: " + progress + " solutions: " + solutions + " duration: " + duration))
      .onFinish(self -> System.out.println("Found " + self.getSolutions() + " solutions in " + self.getDuration() + " ms"))
      .setN(16)
      .solve();</p>

<h2>5.4 Implement your own algorithm</h2>

<p>The abstract class Solver provides a good structure and handy features for your own N Queens Problem solution algorithm. Just extend it and fill the abstract methods with your code.
<br>The method names are self explanatory.</p>

<h1>6 References</h1>

<p>This solution is based on three ideas, especially the first two:</p>

<ul>
<li><p>using bits to represent the occupancy of the board; based on the <a href="http://users.rcn.com/liusomers/nqueen_demo/nqueens.html">implementation by Jeff Somers </a></p></li>
<li><p>calculating start constellations, in which the borders of the board are already occupied by 3 or 4 queens; based on the <a href="https://github.com/preusser/q27">implementation by the TU Dresden</a> (a very good description of this method can be found <a href="http://www.nqueens.de/sub/SearchAlgoUseSymm.en.html">here</a>)</p></li>
<li><p>GPU: remember board-leaving diagonals when going to the next row, so that they can be reinserted when we go backwards. This has also been done in Ping Che Chen's implementation (https://forum.beyond3d.com/threads/n-queen-solver-for-opencl.47785/) of the N Queens Problem for GPU's. </p></li>
</ul>

<h1>7 Contact</h1>

<p>If you have a comment, question, idea or whatever, we will be happy to answer!
Mail: olepoeschl.developing@gmail.com</p>

</body>
</html>
